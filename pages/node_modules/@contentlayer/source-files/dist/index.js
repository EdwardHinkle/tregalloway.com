import * as tracing_1 from "@effect-ts/core/Tracing";
const fileName_1 = "packages/@contentlayer/source-files/src/index.ts";
import * as core from '@contentlayer/core';
import { processArgs, SourceProvideSchemaError } from '@contentlayer/core';
import { unknownToAbsolutePosixFilePath } from '@contentlayer/utils';
import { pipe, S, T } from '@contentlayer/utils/effect';
import { fetchData } from './fetchData/index.js';
import { makeCoreSchema } from './schema/provideSchema.js';
export * from './types.js';
export * from './schema/defs/index.js';
export const makeSource = async (args) => {
    const { options, extensions, restArgs: { documentTypes, contentDirPath, contentDirInclude, contentDirExclude, onUnknownDocuments = 'skip-warn', onMissingOrIncompatibleData = 'skip-warn', onExtraFieldData = 'warn', }, } = await processArgs(args);
    const flags = { onUnknownDocuments, onExtraFieldData, onMissingOrIncompatibleData };
    const documentTypeDefs = (Array.isArray(documentTypes) ? documentTypes : Object.values(documentTypes)).map((_) => _.def());
    return {
        type: 'local',
        extensions: extensions ?? {},
        options,
        provideSchema: (esbuildHash) => (T.mapError_(makeCoreSchema({ documentTypeDefs, options, esbuildHash }), (error) => new SourceProvideSchemaError({ error }), fileName_1 + ":104:19")),
        fetchData: ({ schemaDef, verbose }) => (S.chain_(S.fromEffect(core.getCwd), (cwd) => fetchData({
            coreSchemaDef: schemaDef,
            documentTypeDefs,
            flags,
            options,
            contentDirPath: unknownToAbsolutePosixFilePath(contentDirPath, cwd),
            contentDirExclude: (contentDirExclude ?? contentDirExcludeDefault).map((_) => unknownToAbsolutePosixFilePath(_, cwd)),
            contentDirInclude: (contentDirInclude ?? []).map((_) => unknownToAbsolutePosixFilePath(_, cwd)),
            verbose,
        }))),
    };
};
export const contentDirExcludeDefault = ['node_modules', '.git', '.yarn', '.cache', '.next', '.contentlayer'];
//# sourceMappingURL=index.js.map